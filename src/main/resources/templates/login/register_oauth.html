<!DOCTYPE html>
<html>
<head>
<base href="/" />
<meta charset="UTF-8">
<title>소셜 회원가입</title>
<link rel="stylesheet" type="text/css" href="css/register.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<!-- 별도의 script도 생성 -->
<style>
@import url('https://fonts.googleapis.com/css?family=Gowun+Batang&display=swap');
.swal-footer {
	text-align: center;
}

.container {
	min-height: 770px;
}

</style>

<script type="text/javascript">

	$(function(){
		
		$("#check").click(function() {
			 window.open("./login/idcheck1", "중복 체크", "width=450,height=270,left=600");
		});
		
		
		
		
	});
	
	
	function sendIt() {
		
		var f = document.myForm;
		
		var event = window.event || arguments.callee.caller.arguments[0];

		
		//생년월일 입력 오류 메시지
		str_birth = f.birth.value;
		str_birth = str_birth.trim();
		
		if(str_birth==""){
			swal({
				  title: "생년월일 입력오류",
				  text: "생년월일을 입력하세요.",
				  icon: "error",
				  button: "확인",
				});
			event.preventDefault();
			return;
		}

		
		
		//전화번호 입력 오류메시지
		str_tel1 = f.tel1.value;
		str_tel1 = str_tel1.trim();
		str_tel2 = f.tel2.value;
		str_tel2 = str_tel2.trim();
		str_tel3 = f.tel3.value;
		str_tel3 = str_tel3.trim();
		
		if(str_tel1=="" || str_tel2=="" || str_tel3==""){
			
			swal({
				  title: "전화번호 입력오류",
				  text: "전화번호를 입력하세요.",
				  icon: "error",
				  button: "확인",
				});
			event.preventDefault();
			return;
		}
		
		
		if (confirm("회원가입을 하시겠습니까?")) {
		    
			//이미 가입된 전화번호가 있을시 오류창을 띄우는 ajax
		    $.ajax({
		        url: './login/telCheck',
		        type: 'post',
		        data: {tel1:str_tel1,tel2:str_tel2,tel3:str_tel3},
		        success: function(result) {
		            if(result!="unavailable") {
		            	swal({
		            		title: "회원가입 완료",
		            		text: "회원가입이 완료되었습니다!",
		            		icon: "success",
		            		button: "로그인하기",
		            		}).then(function() {
		            			//비활성화된 아이디입력 input박스를 가입버튼을 누를때 활성화
		            		    //그렇지 않으면 컨트롤러에서 값을 가져오지 못함
		            			var userInput = document.getElementsByName("userid")[0];
		            			var userNameInput = document.getElementsByName("username")[0];
		            			var emailInput = document.getElementsByName("email")[0];
		            			userInput.disabled = false;
		            			userNameInput.disabled = false;
		            			emailInput.disabled = false;
		            			
				                f.action="login/register_ok";
				                f.submit();
		            		});
		            }
		            else {
		                swal({
		  				  title: "전화번호 등록 오류",
		  				  text: "이미 가입된 전화번호입니다. 다른 번호를 입력해주세요.",
		  				  icon: "error",
		  				  button: "확인",
		  				});
		            }
		        },
		    });
		    event.preventDefault();
		} 
		else {
		    event.preventDefault();
		}
		
	}
	
	function back() {
		
		var f = document.myForm;
		f.action="login/back";
		f.submit();
		
	}

	
	function showCalendar() {
		
	    var input = document.getElementById("birthdate");
	    
	    if (input.value=="") {
	      	input.value = "2000-01-01";
	    }
	}
	
</script>


</head>
<body>




<div class="container" id="container">
	<div class="form-container sign-in-container">
		<form action="" name="myForm" method="post" autocomplete="off">
			<h1>소셜로그인 회원가입</h1>
			<br/>
				<p>아이디</p>
				<input type="text" name="userid" th:value="${oauthId}" disabled="disabled"/>
			<br/>
				<p>이름</p>
				<input type="text" name="username" th:value="${oauthName}" disabled="disabled" />
			<br/>
				<p>생년월일</p>
			<div style="width: 100%;">
				<input type="date" name="birth" id="birthdate" value="" onclick="showCalendar()">
			</div>
			
				
			<br/>
				<p>이메일</p>
				<input type="text" name="email" th:value="${oauthId}" disabled="disabled"/>
			<br/>
				<p>전화번호</p>
				<div>
				<input type="text" name="tel1" style="width:19%;"/>
				-
				<input type="text" name="tel2" style="width:19%;"/>
				-
				<input type="text" name="tel3" style="width:19%;"/>
				</div>
			<br/>
			<input type="hidden" name="auth" th:value="oauth">
			<div>
				<button class="btn2" onclick="sendIt();" style="padding:12px 25px;"> 회원가입 </button>
				&nbsp;
				<button class="btn1" onclick="back();" style="padding:12px 30px;"> 로그인 화면으로 </button>
			</div>
				
		</form>
	</div>
</div>



<footer>
	<p>
		footer자리..
	</p>
</footer>

</body>
</html>